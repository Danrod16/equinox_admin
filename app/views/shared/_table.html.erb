<div data-controller="filter">
  <table class="urban-table">
    <tr class="small-row">
      <% headers.each do |header| %>
        <th class="urban-table-header remove-border"> <%= t("table.#{header}") %> </th>
      <% end %>
        <th class="urban-table-header remove-border"> </th>
    </tr>
    <tr>
      <%= simple_form_for controller_name.singularize.to_sym, url: request.url, data: { filter_target: "form" } do |f| %>
        <% headers.each do |header| %>
          <% if records.first.send(header.to_sym).respond_to?(:id) %>
            <% collection = controller_name.singularize.capitalize.constantize.all.extract_associated(header.to_sym).map { |record| record.table_attribute }.uniq %>
          <% else %>
            <% collection = controller_name.singularize.capitalize.constantize.all.pluck(header.to_sym).uniq %>
          <% end %>
          <th class="urban-table-header ">
            <%= f.input header.to_sym,
                        label: false,
                        collection: collection,
                        input_html: {
                          data: {
                            action: "change->filter#filterRecords"
                          }
                        } %>
          </th>
        <% end %>
      <% end %>
      <th class="urban-table-header"> </th>
    </tr>
  </table>
  <table class="urban-table" data-filter-target="view">
    <% if records.any? %>
      <%= render 'shared/table_rows', headers: headers, records: records %>
    <% end %>
  </table>
  <div class="apple_pagination">
    <% unless records.nil? %>
      <%= will_paginate records %>
    <% end %>
  </div>
</div>
